{{> html_skeleton_start.html }}
{{> header.html }}

<div id="page">
  {{#is_available}}
    <script src="/pdf.js" type="text/javascript"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script tyle="text/javascript">
      $(document).ready(function() {
        var socket = io.connect('http://localhost');
        socket.emit("hello",{ idpresentation:{{presentation.idpresentation}} });
        socket.on('hi', function (data) {
          console.log("jetzt kann es losgehen");
          // TODO: erst jetzt kann es losgehn
        });
        socket.on('note', function (data) {
          console.log(data);
          $("#notes-container").append('<div class="note"><b>'+data.user.name+'</b>: <p>'+data.note.text+'</p></div>');
        });
      
        $('#new-note').bind("keypress", function(e) {
          if(e.keyCode == 13){
            if($("#new-note").val().length > 0) {
              $("#notes-container").append('<div class="note"><b>'+$("#username").val()+'</b>: <p>'+$("#new-note").val()+'</p></div>');
              // TODO: this does not implement interface implementation correctly
              // socket.emit("note", { user: $("#username").val(), "text": $("#new-note").val() });
            }
          }
        });
      
        // https://github.com/mozilla/pdf.js/blob/master/examples/helloworld/hello.js
        PDFJS.getDocument('{{presentation.filename}}.pdf').then(function(pdf) {
          // Using promise to fetch the page
          pdf.getPage(1).then(function(page) {
            var scale = 1.5;
            var viewport = page.getViewport(scale);
        
            //
            // Prepare canvas using PDF page dimensions
            //
            var canvas = document.getElementById('pdf-canvas');
            var context = canvas.getContext('2d');
            canvas.height = viewport.height;
            canvas.width = viewport.width;
        
            //
            // Render PDF page into canvas context
            //
            var renderContext = {
              canvasContext: context,
              viewport: viewport
            };
            page.render(renderContext);
          });
        });
      });
    </script>
    <canvas id="pdf-canvas" style="border:1px solid black;"></canvas>
    <div id="content">
      <h1>{{presentation.title}}</h1>
      New note: <input type="text" id="new-note" />
      <h2>Notes:</h2>
      <div id="notes-container">
      </div>
    </div>
  {{/is_available}}
  {{^is_available}}
  <h1>This presentation does not exist!</h1>
  {{/is_available}}
</div>

{{> html_skeleton_end.html }}